<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multitask Judge Architecture</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-width: 1200px;
            width: 100%;
            text-align: center;
        }
        h1 { color: #333; }
        .instructions {
            margin-bottom: 20px;
            color: #666;
            font-size: 0.9em;
        }
        #downloadBtn {
            margin-top: 20px;
            padding: 10px 20px;
            background-color: #0277bd;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        #downloadBtn:hover { background-color: #01579b; }
    </style>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            flowchart: { curve: 'basis' }
        });
    </script>
</head>
<body>
    <div class="container">
        <h1>Multitask Judge Model Architecture</h1>
        <p class="instructions">
            This diagram illustrates the internal flow of the AI Interview Multitask Judge Service.<br>
            <strong>To save as image:</strong> Use a screenshot tool or print to PDF.
        </p>
        
        <div class="mermaid">
graph TD
    %% Define Styles
    classDef client fill:#f9f,stroke:#333,stroke-width:2px;
    classDef service fill:#e1f5fe,stroke:#0277bd,stroke-width:2px;
    classDef core fill:#fff9c4,stroke:#fbc02d,stroke-width:2px;
    classDef model fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px;
    classDef memory fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px;

    %% Client Layer
    User(["User / Client"]) 
    API["FastAPI Endpoints"]
    class User client
    class API service

    %% Service Layer
    subgraph Service_Layer ["Service Layer"]
        direction TB
        Handler1["Generate First Q"]
        Handler2["Evaluate Answer"]
        Handler3["Generate Follow-up"]
        Handler4["Generate Report"]
    end
    class Handler1,Handler2,Handler3,Handler4 service

    %% Logic Layer
    subgraph Logic_Layer ["Logic Core: MultitaskEvaluator"]
        direction TB
        PrepGen["Prepare Gen Prompt (Task: GENERATE)"]
        PrepEval["Prepare Eval Prompt (Task: EVALUATE)"]
        PrepReport["Prepare Report Prompt (Task: REPORT)"]
        InferenceCall["Call Model Manager"]
        SessionMem[("Session Memory")]
    end
    class PrepGen,PrepEval,PrepReport,InferenceCall core
    class SessionMem memory

    %% Model Layer
    subgraph Model_Layer ["Model Layer: MultitaskJudgeModelManager"]
        direction TB
        Tokenize["SentencePiece Tokenizer"]
        Embed["Embedding Layer 512d"]
        PosEnc["Positional Encoding"]
        Transformer["Custom Transformer (8L, 8H)"]
        Cache["Encoder Cache"]
        Decoder["Decoder Loop"]
        SelectToken["Select Token"]
        Decode["Decode Tokens"]
    end
    class Tokenize,Embed,PosEnc,Transformer,Cache,Decoder,SelectToken,Decode model

    %% Connections
    User -->|"API Request"| API
    
    API -->|":/generate-first"| Handler1
    API -->|":/evaluate"| Handler2
    API -->|":/generate"| Handler3
    API -->|":/report"| Handler4

    Handler1 --> PrepGen
    Handler3 --> PrepGen
    Handler2 --> PrepEval
    Handler4 --> PrepReport

    PrepGen --> InferenceCall
    PrepEval --> InferenceCall
    PrepReport --> InferenceCall
    
    SessionMem <--> PrepGen
    
    InferenceCall --> Tokenize
    Tokenize --> Embed
    Embed --> PosEnc
    PosEnc --> Transformer
    Transformer -->|"Encoder Output"| Cache
    Cache --> Decoder
    Decoder -->|"Logits"| SelectToken
    SelectToken -.->|"Autoregressive"| Decoder
    SelectToken --> Decode
        </div>
    </div>
</body>
</html>
